<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>mihalichparty.fun ‚Äî –æ—Ñ—ñ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–∞–π—Ç –¥–æ–ª–∂–Ω—ñ–∫–æ–≤ –ú—ñ—Ö–∞–ª–∏—á–∞</title>
  <style>
    :root {
      --bg: #0d0d10;           /* —Ñ–æ–Ω */
      --card-bg: #18181f;      /* –∫–∞—Ä—Ç–æ—á–∫–∏ */
      --border-soft: #27272f;

      --text-main: #f9fafb;    /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
      --text-soft: #9ca3af;    /* –≤—Ç–æ—Ä–∏—á–Ω—ã–π */

      --accent: #ff7b39;       /* –æ—Ä–∞–Ω–∂–µ–≤—ã–π –∞–∫—Ü–µ–Ω—Ç */
      --accent-soft: #fb923c;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      min-height: 100vh;
    }

    a {
      color: var(--accent-soft);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-soft);
      background: rgba(10, 10, 14, 0.96);
      backdrop-filter: blur(10px);
    }

    .logo-block {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .logo {
      font-size: 18px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .logo span {
      color: var(--accent);
    }

    .subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    nav {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 5px 10px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      background: #15151b;
      color: var(--text-main);
      transition: background 0.08s ease, color 0.08s ease, box-shadow 0.08s ease, border-color 0.08s ease;
    }

    .nav-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      background: #1f1f26;
      box-shadow: 0 0 0 1px rgba(255, 123, 57, 0.4);
    }

    main {
      padding: 14px;
      max-width: 1150px;
      margin: 0 auto 40px;
    }

    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    @media (max-width: 1024px) {
      .grid-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      position: relative;
      border-radius: 16px;
      border: 1px solid var(--border-soft);
      background: var(--card-bg);
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.65);
      padding: 10px;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.04), transparent 60%);
      opacity: 1;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .pill {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
      background: rgba(10, 10, 14, 0.9);
      text-transform: uppercase;
    }

    .small-text {
      font-size: 11px;
      color: var(--text-soft);
    }

    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-soft), transparent);
      margin: 4px 0 6px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* ACCOUNT PANEL */
    .account-panel {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }

    .account-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--accent-soft);
      background: #111;
      flex-shrink: 0;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .input {
      width: 100%;
      padding: 5px 7px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: #111118;
      color: var(--text-main);
      font-size: 12px;
      font-family: inherit;
    }

    .select {
      padding: 5px 7px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: #111118;
      color: var(--text-main);
      font-size: 12px;
      font-family: inherit;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--accent);
      background: var(--accent);
      color: #111;
      font-weight: 600;
      letter-spacing: 0.05em;
      font-size: 11px;
      padding: 6px 10px;
      cursor: pointer;
      text-transform: uppercase;
      white-space: nowrap;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
    }

    .btn:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
      transform: translateY(-1px);
      background: var(--accent-soft);
    }

    .btn-ghost {
      background: transparent;
      border-color: var(--border-soft);
      color: var(--text-soft);
    }

    .btn-ghost:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn-danger {
      border-color: var(--danger);
      background: var(--danger);
      color: #111;
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    .btn-sm {
      font-size: 10px;
      padding: 4px 8px;
    }

    .badge-voice {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(15, 15, 20, 0.9);
      color: var(--accent-soft);
    }

    /* FEED */
    .feed-new {
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      max-height: 140px;
      resize: vertical;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: #111118;
      color: var(--text-main);
      font-size: 12px;
      font-family: inherit;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .feed-list {
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .post {
      border-radius: 10px;
      border: 1px solid rgba(39, 39, 47, 0.9);
      background: #111118;
      padding: 6px 8px;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .post-header {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 3px;
      font-size: 10px;
      color: var(--text-soft);
    }

    .post-user {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .post-user img {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      object-fit: cover;
      border: 1px solid rgba(148, 163, 184, 0.8);
    }

    .post-name {
      color: var(--accent-soft);
    }

    .post-tag {
      font-size: 9px;
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
    }

    .post-image {
      margin-top: 4px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border-soft);
      max-height: 180px;
    }

    .post-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* VOICE CHAT */
    .voice-list {
      max-height: 240px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 6px;
      font-size: 12px;
    }

    .voice-item {
      border-radius: 9px;
      border: 1px solid var(--border-soft);
      background: #111118;
      padding: 4px 6px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .voice-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .voice-top {
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .voice-text {
      font-size: 11px;
      color: var(--text-main);
    }

    /* DRAWING */
    .draw-wrapper {
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      background: #111118;
      padding: 6px;
    }

    canvas {
      width: 100%;
      height: 220px;
      background:
        repeating-linear-gradient(45deg, #111118, #111118 8px, #14141c 8px, #14141c 16px);
      border-radius: 10px;
      cursor: crosshair;
      display: block;
    }

    .draw-controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
      margin-top: 5px;
      font-size: 11px;
      color: var(--text-soft);
    }

    /* GAME */
    .game-box {
      border-radius: 12px;
      border: 1px dashed var(--border-soft);
      background: #111118;
      padding: 6px;
      font-size: 12px;
      margin-bottom: 8px;
    }

    .score-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      color: var(--accent-soft);
      background: rgba(15, 15, 20, 0.9);
      display: inline-block;
      margin-bottom: 4px;
    }

    .leaderboard {
      max-height: 200px;
      overflow-y: auto;
      padding-right: 3px;
      font-size: 11px;
      margin-top: 4px;
    }

    .lb-row {
      display: flex;
      justify-content: space-between;
      padding: 2px 0;
      border-bottom: 1px dashed var(--border-soft);
    }

    .lb-row span:first-child {
      color: var(--text-main);
    }

    footer {
      padding: 10px;
      text-align: center;
      font-size: 11px;
      color: var(--text-soft);
      border-top: 1px solid var(--border-soft);
      background: #111118;
    }

    .ticker {
      background: #111118;
      color: var(--text-main);
      font-weight: 600;
      font-size: 12px;
      padding: 6px 0;
      overflow: hidden;
      border-top: 1px solid var(--border-soft);
      border-bottom: 1px solid var(--border-soft);
    }

    .ticker-inner {
      display: inline-block;
      white-space: nowrap;
      animation: tickerMove 18s linear infinite;
    }

    @keyframes tickerMove {
      0% { transform: translateX(100vw); }
      100% { transform: translateX(-100vw); }
    }

    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #090910;
    }
    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 999px;
    }
  </style>
</head>
<body>

<header>
  <div class="logo-block">
    <div class="logo">mihalich<span>party.fun</span></div>
    <div class="subtitle">
      –æ—Ñ—ñ—Ü—ñ–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç–∞–ª –¥–æ–ª–∂–Ω—ñ–∫–æ–≤, –µ–º–æ—á–µ–∫ —ñ –∫—Ä—ñ–Ω–∂-–∫–æ—Ä–æ–ª—ñ–≤. –º—ñ—Ö–∞–ª–∏—á —Å–ª—ñ–¥–∫—É—î üëÅ
    </div>
  </div>
  <nav>
    <button class="nav-btn active" data-page="main">–≥–ª–∞–≤–Ω–∞</button>
    <button class="nav-btn" data-page="chat">–ø–æ—Å—Ç–∏/—á–∞—Ç</button>
    <button class="nav-btn" data-page="paint">—Ä–∏—Å–æ–≤–∞–ª–∫–∞</button>
    <button class="nav-btn" data-page="games">—ñ–≥—Ä–∏/–ª—ñ–¥–µ—Ä–±–æ—Ä–¥</button>
    <button class="nav-btn" data-page="account">–∞–∫–∫–∞—É–Ω—Ç</button>
  </nav>
</header>

<main>
  <div class="grid-main">

    <!-- LEFT COLUMN: ACCOUNT + VOICE CHAT (section changes by page) -->
    <section class="card">
      <div class="card-inner">

        <!-- ACCOUNT SECTION (page: account / main mini) -->
        <div id="section-account" class="section active">
          <div class="card-title">
            üë§ –ê–∫–∫–∞—É–Ω—Ç –¥–æ–ª–∂–Ω—ñ–∫–∞
            <span class="pill">–ø—Ä–æ—Ñ—ñ–ª—å</span>
          </div>
          <div class="divider"></div>
          <p class="small-text">
            –í–≤–µ–¥–∏ –Ω—ñ–∫, –∫–∞—Ä—Ç—ñ–Ω–∫—É —ñ –≥–æ–ª–æ—Å–æ–≤–∏–π –ø—Ä–µ—Å–µ—Ç. –¶–µ –±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø–æ—Å—Ç–∞—Ö, –≥–æ–ª–æ—Å–æ–≤–∏—Ö —ñ –≥—Ä–∞—Ñ—Ñ—ñ—Ç—ñ.
          </p>

          <div class="account-panel">
            <div class="account-row">
              <div class="avatar">
                <img id="avatarPreview" src="https://i.imgur.com/4ZQZ4Yy.png" alt="avatar">
              </div>
              <div style="flex:1;">
                <input id="usernameInput" class="input" placeholder="–Ω—ñ–∫ (—Ç–∏–ø–æ '—à–ª–∞–∫_—ñ–∑_–ø—ñ–¥—ó–∑–¥–∞')" />
                <input id="avatarInput" class="input" placeholder="url –Ω–∞ –∞–≤–∞—Ç–∞—Ä (–∫–∞—Ä—Ç—ñ–Ω–∫–∞)" style="margin-top:4px;">
              </div>
            </div>

            <div class="account-row">
              <span class="small-text">–≥–æ–ª–æ—Å:</span>
              <select id="voicePreset" class="select">
                <option value="base">normal (0 cents)</option>
                <option value="p200">pitch +200 cents (—á—É—Ç—å –≤–∏—â–µ)</option>
                <option value="m200">pitch -200 cents (—á—É—Ç—å –Ω–∏–∂—á–µ)</option>
                <option value="p400">pitch +400 cents (–∞–Ω—ñ–º–µ –º–∞–ª—å—á—ñ–∫)</option>
                <option value="m400">pitch -400 cents (–¥—è–¥—è –∑ –ø—ñ–¥–≤–∞–ª–∞)</option>
              </select>
              <span id="voiceBadge" class="badge-voice">–ø—Ä–µ—Å–µ—Ç: normal</span>
            </div>

            <div class="account-row" style="justify-content:flex-end; gap:6px;">
              <button class="btn btn-sm" onclick="saveProfile()">–∑–±–µ—Ä–µ–≥—Ç–∏</button>
              <button class="btn-ghost btn-sm" onclick="resetProfile()">–æ–±–Ω—É–ª–∏—Ç—å</button>
            </div>

            <p class="small-text" id="accountStatus">
              —Å—Ç–∞—Ç—É—Å: –≥—ñ—Å—Ç—å. –∑–±–µ—Ä–µ–∂–∏ –ø—Ä–æ—Ñ—ñ–ª—å —à–æ–± —Å—Ç–∞—Ç–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –¥–æ–ª–∂–Ω—ñ–∫–æ–º.
            </p>
          </div>
        </div>

        <!-- VOICE CHAT SECTION (page: chat) -->
        <div id="section-voice" class="section">
          <div class="card-title">
            üîä ¬´–ì–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç¬ª –º—ñ—Ö–∞–ª–∏—á-—Å—Ç–∞–π–ª
            <span class="pill">tts —á–∞—Ç</span>
          </div>
          <div class="divider"></div>
          <p class="small-text">
            –¢—É—Ç —Ç–∏ –ø–∏—à–µ—à —è–∫ –±—É–¥—Ç–æ –≥–æ–ª–æ—Å–æ–≤–µ, –∞ –¥–≤–∏–∂–æ–∫ —á–∏—Ç–∞—î —Ç–µ–∫—Å—Ç –≥–æ–ª–æ—Å–æ–º –∑ —Ç–≤–æ—ó–º pitch.  
            –£ –≤—Å—ñ—Ö —Ä–∞–∑–Ω–∏–π –≥–æ–ª–æ—Å –ø–æ –ø—Ä–µ—Å–µ—Ç—É. –¶–µ –¥–µ—à–µ–≤–∏–π Discord –≤—ñ–¥ –ú—ñ—Ö–∞–ª–∏—á–∞.
          </p>

          <textarea id="voiceInput" placeholder="–Ω–∞–ø–∏—à—ñ—Ç—å —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ..."></textarea>
          <div class="btn-row">
            <button class="btn btn-sm" onclick="sendVoice()">–≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–µ</button>
            <button class="btn-ghost btn-sm" onclick="testMyVoice()">–ø—Ä–æ—Å–ª—É—Ö–∞—Ç—å —Å–≤—ñ–π –ø—Ä–µ—Å–µ—Ç</button>
          </div>

          <div class="voice-list" id="voiceList"></div>
        </div>

      </div>
    </section>

    <!-- CENTER COLUMN: MAIN + FEED -->
    <section class="card">
      <div class="card-inner">

        <!-- MAIN PAGE -->
        <div id="section-main" class="section active">
          <div class="card-title">
            üéâ mihalichparty.fun
            <span class="pill">–≥–ª–∞–≤–Ω–∞</span>
          </div>
          <div class="divider"></div>
          <p class="small-text">
            –†—ñ–±—è—Ç–∞ —Ü–µ –æ—Ñ—ñ—Ü—ñ–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç–∞–ª –¥–µ:
            <br>‚Äî –≤–∏ —Ä–æ–±–∏—Ç–µ –ø–æ—Å—Ç–∏ —è–∫ –¥–µ–≥–µ–Ω–µ—Ä–∞—Ç–∏  
            <br>‚Äî –∫—Ä–∏—á–∏—Ç–µ –≤ ¬´–≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç¬ª –∑ —Ñ–µ–π–∫–æ–≤–∏–º –≥–æ–ª–æ—Å–æ–º  
            <br>‚Äî –º–∞–ª—é—î—Ç–µ –≥—Ä–∞—Ñ—Ñ—ñ—Ç—ñ –Ω–∞ –æ–¥–Ω—ñ–π –º–∞–ø—ñ  
            <br>‚Äî –∑–º–∞–≥–∞—î—Ç–µ—Å—å –≤ —Ç—É–ø–∏—Ö —ñ–≥—Ä–∞—Ö –∑–∞ –∑–≤–∞–Ω–Ω—è ¬´–ª—é–±–∏–º–∏–π –¥–æ–ª–∂–Ω—ñ–∫ –ú—ñ—Ö–∞–ª–∏—á–∞¬ª.
          </p>
          <p class="small-text">
            –®–æ–± –≤—Å—å–æ —Ä–∞–±–∏—Ç–∞–ª–æ –Ω–æ—Ä–º: <b>–∑–∞–ø–æ–≤–Ω—ñ—Ç—å –∞–∫–∫–∞—É–Ω—Ç</b>, –∞ –ø–æ—Ç—ñ–º –π–¥—ñ—Ç—å –ø–æ –≤–∫–ª–∞–¥–∫–∞–º.  
            –ù—ñ—á–æ –Ω–µ –∫–∞—á–∞—î—Ç—å—Å—è, –≤—Å—å–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ, –ø–æ–ª—ñ—Ü—ñ—è —Å–ø–∏—Ç—å.
          </p>
        </div>

        <!-- CHAT/POST FEED -->
        <div id="section-chat" class="section">
          <div class="card-title">
            üí¨ –§—ñ–¥ –¥–æ–ª–∂–Ω—ñ–∫–æ–≤
            <span class="pill">–ø–æ—Å—Ç–∏/—á–∞—Ç</span>
          </div>
          <div class="divider"></div>
          <p class="small-text">
            –ü–æ—Å—Ç–∏ –±–∞—á–∞—Ç—å –≤—Å—ñ, –∫—Ç–æ –Ω–∞ —Å–∞–π—Ç—ñ. –ü–∏—à–∏, –¥–æ–±–∞–≤–ª—è–π –∫–∞—Ä—Ç—ñ–Ω–∫–∏ (url), —Å—Ç—Ä–æ–π –∫—Ä—ñ–Ω–∂-—ñ–º—ñ–¥–∂.
          </p>

          <div class="feed-new">
            <textarea id="postText" placeholder="–Ω–∞–ø–∏—à–∏ —Å—é–¥–∞ –ø–æ—Å—Ç, –∫—Ä–∏–∫ –¥—É—à—ñ, –º–µ–º, –¥–µ–ø—Ä—É..."></textarea>
            <input id="postImageUrl" class="input" placeholder="url –Ω–∞ –∫–∞—Ä—Ç—ñ–Ω–∫—É (–Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ)" style="margin-top:4px;">

            <div class="btn-row">
              <button class="btn btn-sm" onclick="createPost()">–∑–∞–ø–æ—Å—Ç–∏—Ç—å</button>
              <button class="btn-ghost btn-sm" onclick="generateRandomPost()">—Ä–∞–Ω–¥–æ–º–Ω–∏–π –ø–æ—Å—Ç</button>
              <button class="btn-danger btn-sm" onclick="clearMyPosts()">—Å—Ç–µ—Ä–µ—Ç—å —Å–≤–æ—î (–ª–æ–∫–∞–ª—å–Ω–æ)</button>
            </div>

            <p class="small-text">
              ‚ö† –ü–æ—Å—Ç–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Firebase Firestore (–æ–±—â—ñ –¥–ª—è –≤—Å—ñ—Ö).  
              –ö–Ω–æ–ø–∫–∞ ¬´—Å—Ç–µ—Ä–µ—Ç—å¬ª —É–¥–∞–ª—è—î —Ç—ñ–ª—å–∫–∏ –∫—î—à —É —Ç–µ–±–µ, –Ω–µ —ñ–∑ –º–∏—Ä–∞ –¥–æ–ª–∂–Ω—ñ–∫–æ–≤.
            </p>
          </div>

          <div class="feed-list" id="feedList"></div>
        </div>

      </div>
    </section>

    <!-- RIGHT COLUMN: DRAW / GAMES -->
    <section class="card">
      <div class="card-inner">

        <!-- DRAW -->
        <div id="section-paint" class="section">
          <div class="card-title">
            üñå –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ä–∏—Å–æ–≤–∞–ª–∫–∞
            <span class="pill">–≥—Ä–∞—Ñ—Ñ—ñ—Ç—ñ –º–∞–ø–∞</span>
          </div>
          <div class="divider"></div>
          <p class="small-text">
            –¢—É—Ç –æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π —Ö–æ–ª—Å—Ç –¥–ª—è –≤—Å—ñ—Ö. –ö–æ–∂–µ–Ω —à—Ç—Ä–∏—Ö –ª–µ—Ç–∏—Ç—å –≤ Firebase.  
            –ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ —Ö–æ–ª—Å—Ç —â–æ–± –º–∞–ª—é–≤–∞—Ç–∏, —É—Å—ñ –±–∞—á–∞—Ç—å —Ç–≤–æ–π —à–µ–¥–µ–≤—Ä. –ù–µ –º–∞–ª—é–π —Ö*–π–Ω—é‚Ä¶ —Ö–æ—á–∞ –∫–æ–≥–æ —è –ø—Ä–æ—à—É.
          </p>

          <div class="draw-wrapper">
            <canvas id="paintCanvas"></canvas>
            <div class="draw-controls">
              <span>–∫–æ–ª—ñ—Ä:</span>
              <input type="color" id="drawColor" value="#ff7b39">
              <span>—Ä–æ–∑–º—ñ—Ä:</span>
              <input type="range" id="drawSize" min="1" max="20" value="4">
              <button class="btn-ghost btn-sm" onclick="clearLocalCanvas()">–æ—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ</button>
            </div>
            <p class="small-text">
              ‚ö† –û—á–∏—Å—Ç–∫–∞ —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Ç–≤–æ—î–º—É –µ–∫—Ä–∞–Ω—ñ, –¥–∞–Ω–Ω—ã–µ –≤ Firestore –æ—Å—Ç–∞—é—Ç—Å—è.  
              –Ø–∫—â–æ —Ö–æ—á–µ—à —Ä–µ–∞–ª—å–Ω–∏–π –≤–∞–π–ø ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ú—ñ—Ö–∞–ª–∏—á v2.
            </p>
          </div>
        </div>

        <!-- GAMES -->
        <div id="section-games" class="section">
          <div class="card-title">
            üïπ –Ü–≥—Ä–∏ –ú—ñ—Ö–∞–ª–∏—á–∞
            <span class="pill">2 –º—ñ–Ω—ñ–º—É–º</span>
          </div>
          <div class="divider"></div>

          <!-- GAME 1: CLICKER -->
          <div class="game-box">
            <div class="score-badge" id="scoreClickBadge">clicker score: 0</div>
            <p class="small-text">
              –Ü–≥—Ä–∞ ‚Ññ1: ¬´–ö–ª—ñ–∫–Ω–∏ –±–æ—Ä–≥¬ª. –ü—Ä–æ—Å—Ç–æ —Ç–∏—Å–Ω–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É, –∑–±–∏—Ä–∞–π –ø–æ—ñ–Ω—Ç–∏.  
              –ú–æ–∂–µ—à –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥.
            </p>
            <div class="btn-row">
              <button class="btn btn-sm" onclick="clickGame()">–∫–ª—ñ–∫–Ω—É—Ç–∏ –±–æ—Ä–≥</button>
              <button class="btn-ghost btn-sm" onclick="resetClickGame()">–æ–±–Ω—É–ª–∏—Ç—å —Å–µ–±–µ</button>
              <button class="btn btn-sm" onclick="saveScore('clicker')">–∑–±–µ—Ä–µ–≥—Ç–∏ –≤ —Ç–æ–ø</button>
            </div>
            <p class="small-text" id="clickComment"></p>
          </div>

          <!-- GAME 2: REACTION -->
          <div class="game-box">
            <div class="score-badge" id="scoreReactBadge">reaction best: ‚Äî</div>
            <p class="small-text">
              –Ü–≥—Ä–∞ ‚Ññ2: ¬´–†–µ–∞–∫—Ü—ñ—è –Ω–∞ –ú—ñ—Ö–∞–ª–∏—á–∞¬ª.  
              –ñ–º–∏ ¬´—Å—Ç–∞—Ä—Ç¬ª, –∂–¥–∏ –ø–æ–∫–∏ –∫–æ—Ä–æ–±–∫–∞ —Å—Ç–∞–Ω–µ <span style="color:var(--accent-soft);">–∑–µ–ª–µ–Ω–æ—é</span>, –ø–æ—Ç—ñ–º –∫–ª—ñ–∫.  
              –ß–∏–º –º–µ–Ω—à–∏–π —á–∞—Å, —Ç–∏–º —Ç–∏ –º–µ–Ω—à–µ –∑–∞–ª–∏–ø–∞—î—à.
            </p>
            <div style="margin:6px 0;">
              <div id="reactBox" style="height:60px; border-radius:10px; background:#3b1111; display:flex; align-items:center; justify-content:center; font-size:12px;">
                –∂–¥—å–æ–º —Å—Ç–∞—Ä—Ç...
              </div>
            </div>
            <div class="btn-row">
              <button class="btn btn-sm" onclick="startReactionGame()">—Å—Ç–∞—Ä—Ç</button>
              <button class="btn btn-sm" onclick="saveScore('reaction')">–∑–±–µ—Ä–µ–≥—Ç–∏ –≤ —Ç–æ–ø</button>
            </div>
            <p class="small-text" id="reactComment"></p>
          </div>

          <!-- LEADERBOARD -->
          <div class="game-box">
            <p class="small-text">
              üèÜ –¢–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤ (–æ–±—â–∞ –¥–ª—è –≤—Å—ñ—Ö).  
              –•—Ç–æ –Ω–∞–π–±—ñ–ª—å—à–µ –∫–ª—ñ–∫–Ω—É–≤ —ñ —Ö—Ç–æ –Ω–∞–π—à–≤–∏–¥—à–µ –∑—Ä–µ–∞–≥—É–≤–∞–≤.
            </p>
            <div class="leaderboard" id="leaderboard"></div>
          </div>

        </div>

      </div>
    </section>

  </div>
</main>

<div class="ticker">
  <div class="ticker-inner">
    –£–í–ê–ì–ê: –í–°–Ü –î–û–õ–ñ–ù–Ü–ö–Ü –ú–Ü–•–ê–õ–ò–ß–ê –û–ë–Ø–ó–ê–ù–Ü –ó–ê–ô–¢–ò –ù–ê –°–ê–ô–¢, –ó–†–û–ë–ò–¢–ò –ü–û–°–¢, –ì–û–õ–û–°–û–í–ï –Ü –•–û–ß –†–ê–ó –í–ò–ì–†–ê–¢–ò –í –Ü–ì–†–Ü. –ù–ï –í–ò–ö–û–ù–ê–í ‚Äî –ü–û–î –ü–†–û–¶–ï–ù–¢–ê–ú–Ü!!! üí∏üí∏üí∏
  </div>
</div>

<footer>
  ¬© mihalichparty.fun ‚Äî —è–∫—â–æ —Ç–∏ —Ü–µ —á–∏—Ç–∞—î—à, —Ç–∏ –∞–≤—Ç–æ–º–∞—Ç—ñ—á–Ω–æ –¥–æ–ª–∂–µ–Ω 50 –≥—Ä–Ω.  
  –°–∞–π—Ç —Ä–æ–±–∏–≤—Å—è –≤ –Ω–æ—á—ñ, –±–µ–∑ —Å–Ω–∞, –±–µ–∑ —Ç–µ—Ö–Ω—ñ—á–∫–∏, –≤ —á–µ—Å—Ç –ú—ñ—Ö–∞–ª–∏—á–∞.
</footer>

<!-- Firebase (compat version –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏) -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<script>
  // -----------------------------------------------------------
  // 1. Firebase –∫–æ–Ω—Ñ—ñ–≥ ‚Äî —Ç–≤—ñ–π —Ä–µ–∞–ª—å–Ω–∏–π
  // -----------------------------------------------------------
  const firebaseConfig = {
    apiKey: "AIzaSyAMt6y5Ys7a1wjiqftkoC_EsjHmcaJrvYo",
    authDomain: "mihalichpartyfun.firebaseapp.com",
    projectId: "mihalichpartyfun",
    storageBucket: "mihalichpartyfun.firebasestorage.app",
    messagingSenderId: "489168444978",
    appId: "1:489168444978:web:3b1970550ce6d39c03262b",
    measurementId: "G-BQZBY5JZXM"
  };

  let db = null;
  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
  } catch (e) {
    console.warn("Firebase –Ω–µ —Å–∫–æ–Ω—Ñ—ñ–≥—É—Ä–æ–≤–∞–Ω–∏–π, –ø—Ä–∞—Ü—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –æ–Ω–ª–∞–π–Ω–∞.", e);
  }

  // -----------------------------------------------------------
  // 2. SPA –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è
  // -----------------------------------------------------------
  const navButtons = document.querySelectorAll(".nav-btn");
  const sectionMain = document.getElementById("section-main");
  const sectionChat = document.getElementById("section-chat");
  const sectionPaint = document.getElementById("section-paint");
  const sectionGames = document.getElementById("section-games");
  const sectionAccount = document.getElementById("section-account");
  const sectionVoice = document.getElementById("section-voice");

  function setPage(page) {
    navButtons.forEach(btn => {
      btn.classList.toggle("active", btn.dataset.page === page);
    });

    [sectionMain, sectionChat, sectionPaint, sectionGames, sectionAccount, sectionVoice]
      .forEach(sec => sec && sec.classList.remove("active"));

    if (page === "main") sectionMain.classList.add("active");
    if (page === "chat") {
      sectionChat.classList.add("active");
      sectionVoice.classList.add("active");
    }
    if (page === "paint") sectionPaint.classList.add("active");
    if (page === "games") sectionGames.classList.add("active");
    if (page === "account") sectionAccount.classList.add("active");
  }

  navButtons.forEach(btn => {
    btn.addEventListener("click", () => setPage(btn.dataset.page));
  });

  // -----------------------------------------------------------
  // 3. –ü—Ä–æ—Ñ—ñ–ª—å —é–∑–µ—Ä–∞ (localStorage)
  // -----------------------------------------------------------
  const usernameInput = document.getElementById("usernameInput");
  const avatarInput = document.getElementById("avatarInput");
  const avatarPreview = document.getElementById("avatarPreview");
  const voicePreset = document.getElementById("voicePreset");
  const voiceBadge = document.getElementById("voiceBadge");
  const accountStatus = document.getElementById("accountStatus");

  const STORAGE_PROFILE = "mihalichparty_profile";

  let currentProfile = {
    name: "",
    avatar: "https://i.imgur.com/4ZQZ4Yy.png",
    voice: "base"
  };

  function loadProfile() {
    try {
      const raw = localStorage.getItem(STORAGE_PROFILE);
      if (raw) {
        currentProfile = JSON.parse(raw);
      }
    } catch(e) { }

    usernameInput.value = currentProfile.name || "";
    avatarInput.value = currentProfile.avatar || "";
    avatarPreview.src = currentProfile.avatar || "https://i.imgur.com/4ZQZ4Yy.png";
    voicePreset.value = currentProfile.voice || "base";
    updateVoiceBadge();

    accountStatus.textContent = currentProfile.name
      ? `—Å—Ç–∞—Ç—É—Å: –æ—Ñ—ñ—Ü—ñ–∞–ª—å–Ω–∏–π –¥–æ–ª–∂–Ω—ñ–∫ –∑ –Ω—ñ–∫–æ–º "${currentProfile.name}".`
      : "—Å—Ç–∞—Ç—É—Å: –≥—ñ—Å—Ç—å. –∑–±–µ—Ä–µ–∂–∏ –ø—Ä–æ—Ñ—ñ–ª—å —à–æ–± —Å—Ç–∞—Ç–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –¥–æ–ª–∂–Ω—ñ–∫–æ–º.";
  }

  function saveProfile() {
    currentProfile.name = usernameInput.value.trim() || "–∞–Ω–æ–Ω—ñ–º–Ω–∏–π –¥–æ–ª–∂–Ω—ñ–∫";
    currentProfile.avatar = avatarInput.value.trim() || "https://i.imgur.com/4ZQZ4Yy.png";
    currentProfile.voice = voicePreset.value;

    avatarPreview.src = currentProfile.avatar;
    updateVoiceBadge();

    localStorage.setItem(STORAGE_PROFILE, JSON.stringify(currentProfile));
    accountStatus.textContent = `—Å—Ç–∞—Ç—É—Å: –æ—Ñ—ñ—Ü—ñ–∞–ª—å–Ω–∏–π –¥–æ–ª–∂–Ω—ñ–∫ –∑ –Ω—ñ–∫–æ–º "${currentProfile.name}".`;
  }

  function resetProfile() {
    currentProfile = {
      name: "",
      avatar: "https://i.imgur.com/4ZQZ4Yy.png",
      voice: "base"
    };
    localStorage.removeItem(STORAGE_PROFILE);
    loadProfile();
  }

  function updateVoiceBadge() {
    const v = voicePreset.value;
    let text = "";
    if (v === "base") text = "normal (0)";
    if (v === "p200") text = "pitch +200 (—á—É—Ç—å –≤–∏—â–µ)";
    if (v === "m200") text = "pitch -200 (—á—É—Ç—å –Ω–∏–∂—á–µ)";
    if (v === "p400") text = "pitch +400 (–∞–Ω—ñ–º–µ –º–∞–ª—å—á—ñ–∫)";
    if (v === "m400") text = "pitch -400 (–¥—è–¥—è –∑ –ø—ñ–¥–≤–∞–ª–∞)";
    voiceBadge.textContent = "–ø—Ä–µ—Å–µ—Ç: " + text;
  }

  voicePreset.addEventListener("change", updateVoiceBadge);

  // -----------------------------------------------------------
  // 4. FEED / –ø–æ—Å—Ç–∏ (Firestore)
  // -----------------------------------------------------------
  const postText = document.getElementById("postText");
  const postImageUrl = document.getElementById("postImageUrl");
  const feedList = document.getElementById("feedList");

  const randomTags = [
    "#–∫—Ä—ñ–Ω–∂", "#–¥–µ–ø—Ä–∞", "#–≤–∞–π–±", "#–Ω—ñ—á—å", "#–¥–æ–ª–∂–Ω—ñ–∫",
    "#2007", "#–µ–º–æ", "#scene", "#–Ω—ñ—á–æ–≥–æ_–Ω–µ_–ø–æ–Ω—è–ª"
  ];

  function getTag() {
    return randomTags[Math.floor(Math.random() * randomTags.length)];
  }

  async function createPost() {
    if (!db) {
      alert("Firebase –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω, –ø–æ—Å—Ç–∏ –Ω–µ –ª–µ—Ç—è—Ç—å –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç. –ü–æ—Ç—Ä—ñ–±–µ–Ω firebaseConfig.");
      return;
    }
    const text = postText.value.trim();
    const img = postImageUrl.value.trim();
    if (!text) return;

    const now = new Date();
    const time = now.toLocaleTimeString();

    const doc = {
      text,
      image: img || null,
      author: currentProfile.name || "–∞–Ω–æ–Ω—ñ–º–Ω–∏–π –¥–æ–ª–∂–Ω—ñ–∫",
      avatar: currentProfile.avatar || "",
      tag: getTag(),
      time,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    await db.collection("posts").add(doc);
    postText.value = "";
    postImageUrl.value = "";
  }

  function renderPost(doc) {
    const d = doc.data();
    const div = document.createElement("div");
    div.className = "post";

    const header = document.createElement("div");
    header.className = "post-header";

    const left = document.createElement("div");
    left.className = "post-user";
    const img = document.createElement("img");
    img.src = d.avatar || "https://i.imgur.com/4ZQZ4Yy.png";
    const name = document.createElement("span");
    name.className = "post-name";
    name.textContent = d.author || "–∞–Ω–æ–Ω—ñ–º";
    const time = document.createElement("span");
    time.textContent = d.time || "";

    left.appendChild(img);
    left.appendChild(name);
    left.appendChild(time);

    const right = document.createElement("span");
    right.className = "post-tag";
    right.textContent = d.tag || "#–≤–∞–π–±";

    header.appendChild(left);
    header.appendChild(right);

    const body = document.createElement("div");
    body.textContent = d.text || "";

    div.appendChild(header);
    div.appendChild(body);

    if (d.image) {
      const imgWrap = document.createElement("div");
      imgWrap.className = "post-image";
      const pic = document.createElement("img");
      pic.src = d.image;
      imgWrap.appendChild(pic);
      div.appendChild(imgWrap);
    }

    return div;
  }

  function subscribePosts() {
    if (!db || !feedList) return;

    db.collection("posts")
      .orderBy("createdAt", "desc")
      .limit(100)
      .onSnapshot(snap => {
        feedList.innerHTML = "";
        snap.forEach(doc => {
          feedList.appendChild(renderPost(doc));
        });
      });
  }

  function generateRandomPost() {
    const templates = [
      "–°–∏–∂—É –Ω–∞ mihalichparty —ñ –¥—É–º–∞—é: —Ü–µ –ª–µ—á–∏—Ç—å—Å—è —á–∏ –≤–∂–µ –≤—Å–µ?",
      "–ö–æ–ª–∏ –≤–∂–µ –∑–∞—Ä–ø–ª–∞—Ç–∞, —è–∫—â–æ —è –Ω–∞–≤—ñ—Ç—å –Ω–µ —Ä–∞–±–æ—Ç–∞—é?",
      "–Ø –æ—Ñ—ñ—Ü—ñ–π–Ω–æ –¥–æ–ª–∂–Ω—ñ–∫, –Ω–æ —Ö–æ—á–∞ –± —Å—Ç–∏–ª—å–Ω–∏–π.",
      "–Ø–∫—â–æ —è –ø—Ä–æ–ø–∞–¥—É –∑ —Å–∞–π—Ç—É, –∑–Ω–∞—á—ñ—Ç –ú—ñ—Ö–∞–ª–∏—á –º–µ–Ω–µ –Ω–∞–π—à–æ–≤.",
      "–ù–∞–π–∫—Ä–∞—â–∏–π —Å–ø–æ—Ä—Ç ‚Äî —Ç—ñ–∫–∞—Ç–∏ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ.",
      "–ù—î–Ω—É –∞ —à–æ, —Ö–æ—á –¥–µ—Å—å —è –º–æ–∂—É —Å—Ç—Ä–∞–¥–∞—Ç—å –ª–µ–≥–∞–ª—å–Ω–æ.",
      "–ü–æ—Å—Ç–∞–≤–∏–≤ —Å–æ–±—ñ –Ω—ñ–∫ —ñ –≤–∂–µ –¥—É–º–∞—é —â–æ –≤ –º–µ–Ω–µ –æ–±—Ä–∞–∑.",
      "–í–∏ —Ç–æ–∂–µ —ñ–Ω–æ–≥–¥–∞ —Å–ª—É—Ö–∞—î—Ç–µ –º—É–∑–æ–Ω —ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î—Ç–µ —à–æ –≤–∏ –≤ –∫–ª—ñ–ø—ñ?",
      "–°—å–æ–≥–æ–¥–Ω—ñ –¥–µ–Ω—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ: —è –≤–∂–µ 4 –≥–æ–¥–∏–Ω–∏ –Ω–∏—á–æ –Ω–µ —Ä–æ–±–ª—é.",
      "–Ø–∫—â–æ –≤ –º–µ–Ω–µ –Ω–µ–º–∞ –ø–ª–∞–Ω—ñ–≤ ‚Äî —Ü–µ —Ç–µ–∂ –ø–ª–∞–Ω, –ø—Ä–∞–≤–∏–ª—å–Ω–æ?"
    ];
    postText.value = templates[Math.floor(Math.random() * templates.length)];
  }

  function clearMyPosts() {
    feedList.innerHTML = "";
  }

  // -----------------------------------------------------------
  // 5. FAKE VOICE CHAT (TTS + Firestore)
  // -----------------------------------------------------------
  const voiceInput = document.getElementById("voiceInput");
  const voiceList = document.getElementById("voiceList");

  function pitchToSpeechVal(preset) {
    // speechSynthesis.pitch: 0..2
    switch (preset) {
      case "p200": return 1.2;
      case "m200": return 0.8;
      case "p400": return 1.4;
      case "m400": return 0.6;
      default: return 1.0;
    }
  }

  function speakTextWithProfile(text, profileOrNull) {
    if (!window.speechSynthesis) {
      alert("–£ —Ç–µ–±–µ –Ω–µ–º–∞—î TTS –≤ –±—Ä–∞—É–∑–µ—Ä—ñ, –≥–æ–ª–æ—Å –Ω–µ –ø—Ä–∞—Ü—é—î. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏ —Å–µ–±–µ.");
      return;
    }
    const u = new SpeechSynthesisUtterance(text);
    const profile = profileOrNull || currentProfile;
    u.pitch = pitchToSpeechVal(profile.voice || "base");
    u.rate = 1.0;
    u.lang = "uk-UA";
    window.speechSynthesis.speak(u);
  }

  function testMyVoice() {
    const text = "–Ø —Ç–≤—ñ–æ–π –≥–æ–ª–æ—Å–æ–≤–∏–π –ø—Ä–µ—Å–µ—Ç. –Ø –∑–≤—É—á—é —Å—Ç—Ä–∞–Ω–Ω–æ, –Ω–æ —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ.";
    speakTextWithProfile(text, currentProfile);
  }

  async function sendVoice() {
    if (!db) {
      alert("Firebase –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω, –≥–æ–ª–æ—Å–æ–≤–∏–π —á–∞—Ç –Ω–µ –æ–Ω–ª–∞–π–Ω. –ü–æ—Ç—Ä—ñ–±–µ–Ω firebaseConfig.");
      return;
    }
    const text = voiceInput.value.trim();
    if (!text) return;
    const now = new Date();
    const time = now.toLocaleTimeString();

    const doc = {
      text,
      author: currentProfile.name || "–∞–Ω–æ–Ω—ñ–º–Ω–∏–π –¥–æ–ª–∂–Ω—ñ–∫",
      avatar: currentProfile.avatar || "",
      voice: currentProfile.voice || "base",
      time,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    await db.collection("voices").add(doc);
    voiceInput.value = "";
  }

  function renderVoice(doc) {
    const d = doc.data();
    const item = document.createElement("div");
    item.className = "voice-item";

    const avatar = document.createElement("img");
    avatar.src = d.avatar || "https://i.imgur.com/4ZQZ4Yy.png";
    avatar.style.width = "26px";
    avatar.style.height = "26px";
    avatar.style.borderRadius = "999px";
    avatar.style.objectFit = "cover";
    avatar.style.border = "1px solid rgba(148, 163, 184, 0.9)";

    const metaWrap = document.createElement("div");
    metaWrap.className = "voice-meta";

    const top = document.createElement("div");
    top.className = "voice-top";
    const name = document.createElement("span");
    name.textContent = d.author || "–∞–Ω–æ–Ω—ñ–º";
    const time = document.createElement("span");
    time.textContent = d.time || "";
    const preset = document.createElement("span");
    preset.className = "badge-voice";
    preset.textContent = "preset: " + (d.voice || "base");

    top.appendChild(name);
    top.appendChild(time);
    top.appendChild(preset);

    const text = document.createElement("div");
    text.className = "voice-text";
    text.textContent = d.text || "";

    const playBtn = document.createElement("button");
    playBtn.className = "btn btn-sm";
    playBtn.textContent = "‚ñ∂Ô∏è –ø—Ä–æ—Å–ª—É—Ö–∞—Ç—å";
    playBtn.addEventListener("click", () => {
      speakTextWithProfile(d.text || "", { voice: d.voice || "base" });
    });

    metaWrap.appendChild(top);
    metaWrap.appendChild(text);

    item.appendChild(avatar);
    item.appendChild(metaWrap);
    item.appendChild(playBtn);

    return item;
  }

  function subscribeVoices() {
    if (!db || !voiceList) return;
    db.collection("voices")
      .orderBy("createdAt", "desc")
      .limit(100)
      .onSnapshot(snap => {
        voiceList.innerHTML = "";
        snap.forEach(doc => {
          voiceList.appendChild(renderVoice(doc));
        });
      });
  }

  // -----------------------------------------------------------
  // 6. DRAW / GRAFFITI (Firestore strokes)
  // -----------------------------------------------------------
  const paintCanvas = document.getElementById("paintCanvas");
  const drawColor = document.getElementById("drawColor");
  const drawSize = document.getElementById("drawSize");
  let ctx = null;
  let drawing = false;
  let lastX = 0;
  let lastY = 0;

  function resizeCanvas() {
    if (!paintCanvas) return;
    const rect = paintCanvas.getBoundingClientRect();
    paintCanvas.width = rect.width;
    paintCanvas.height = 220;
  }

  function getCanvasPos(e) {
    const rect = paintCanvas.getBoundingClientRect();
    if (e.touches && e.touches[0]) {
      return {
        x: e.touches[0].clientX - rect.left,
        y: e.touches[0].clientY - rect.top
      };
    } else {
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }
  }

  function startDraw(e) {
    drawing = true;
    const pos = getCanvasPos(e);
    lastX = pos.x;
    lastY = pos.y;
  }

  function moveDraw(e) {
    if (!drawing || !ctx) return;
    const pos = getCanvasPos(e);
    const color = drawColor.value;
    const size = parseInt(drawSize.value, 10) || 4;

    // –ª–æ–∫–∞–ª—å–Ω–æ —Ä–∏—Å—É–µ–º –ª–∏–Ω–∏—é
    ctx.strokeStyle = color;
    ctx.lineWidth = size;
    ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();

    // —à–ª–µ–º —à—Ç—Ä–∏—Ö –≤ Firestore
    sendStrokeToFirestore(lastX, lastY, pos.x, pos.y, color, size);

    lastX = pos.x;
    lastY = pos.y;
  }

  function stopDraw() {
    drawing = false;
  }

  function clearLocalCanvas() {
    if (!ctx || !paintCanvas) return;
    ctx.clearRect(0, 0, paintCanvas.width, paintCanvas.height);
  }

  async function sendStrokeToFirestore(x1, y1, x2, y2, color, size) {
    if (!db) return; // —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –æ–Ω–ª–∞–π–Ω
    try {
      await db.collection("strokes").add({
        x1, y1, x2, y2,
        color,
        size,
        author: currentProfile.name || "–∞–Ω–æ–Ω—ñ–º",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    } catch(e) { }
  }

  function drawStroke(d) {
    if (!ctx || !paintCanvas) return;
    ctx.strokeStyle = d.color || "#ff7b39";
    ctx.lineWidth = d.size || 4;
    ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(d.x1, d.y1);
    ctx.lineTo(d.x2, d.y2);
    ctx.stroke();
  }

  function subscribeStrokes() {
    if (!db || !paintCanvas) return;
    db.collection("strokes")
      .orderBy("createdAt", "asc")
      .limit(2000)
      .onSnapshot(snap => {
        clearLocalCanvas();
        snap.forEach(doc => drawStroke(doc.data()));
      });
  }

  // -----------------------------------------------------------
  // 7. GAMES + LEADERBOARD
  // -----------------------------------------------------------
  let clickScore = 0;
  const scoreClickBadge = document.getElementById("scoreClickBadge");
  const clickComment = document.getElementById("clickComment");

  function clickGame() {
    clickScore++;
    updateClickScoreBadge();
    if (Math.random() < 0.3) {
      clickComment.textContent = randomClickComment();
    }
  }

  function resetClickGame() {
    clickScore = 0;
    updateClickScoreBadge();
    clickComment.textContent = "—Ç–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ –ø–æ—á–∞–≤ –∂–∏—Ç—Ç—è –∑ –Ω—É–ª—è (–∑–Ω–æ–≤—É).";
  }

  function updateClickScoreBadge() {
    scoreClickBadge.textContent = "clicker score: " + clickScore;
  }

  function randomClickComment() {
    const list = [
      "–∑ —Ç–∞–∫–∏–º —Å—Ç–∞—Ä–∞–Ω–Ω—è–º —Ç–∏ –º—ñ–≥ –±–∏ —É—Ä–æ–∫–∏ —Ä–æ–±–∏—Ç–∏.",
      "—Ç–∏ –ø—Ä–æ—Å—Ç–æ –≤–±–∏–≤–∞—î—à –∫–Ω–æ–ø–∫—É, –æ—Å—Ç–∞–≤ —ó—ó –≤ –ø–æ–∫–æ—î.",
      "–µ—â–µ —á—É—Ç—å-—á—É—Ç—å —ñ –≤ —Ç–µ–±–µ –±—É–¥–µ —Ç—Ä–∞–≤–º–∞ –ø–∞–ª—å—Ü—è.",
      "—è –¥–∏–≤–ª—é—Å—å –Ω–∞ —Ç–µ–±–µ —ñ –¥—É–º–∞—é: '–Ω—É —Ö–æ—á –π–æ–º—É –≤–µ—Å–µ–ª–æ'.",
      "—Ç–∏ —É–∂–µ –≤–∏–≥—Ä–∞–≤? –Ω–µ—Ç. –∞–ª–µ –ø—Ä–æ–¥–æ–≤–∂—É–π.",
      "–º—ñ—Ö–∞–ª–∏—á —Å–ª—ñ–¥–∫—É—î –∑–∞ —Ç–æ–±–æ–π —ñ –∑–∞–ø–∏—Å—É—î –¥–æ–ª–≥–∏.",
      "–∑–∞—á—î–º —Ç–∏ —Ü–µ —Ä–æ–±–∏—à? –∞—Ö –¥–∞, –±–æ –ø—Ä–∏–∫–æ–ª—å–Ω–æ.",
      "–∫–æ–∂–µ–Ω –∫–ª—ñ–∫ ‚Äî —Ü–µ –º—ñ–Ω—É—Å 1 –Ω–µ–π—Ä–æ–Ω, –ø–ª—é—Å 1 –≤–∞–π–±."
    ];
    return list[Math.floor(Math.random() * list.length)];
  }

  let reactionState = "idle";
  let reactionStartTime = 0;
  let reactionBest = null;
  const reactBox = document.getElementById("reactBox");
  const reactComment = document.getElementById("reactComment");
  const scoreReactBadge = document.getElementById("scoreReactBadge");

  function startReactionGame() {
    reactionState = "waiting";
    reactComment.textContent = "–∂–¥–∏, –Ω–µ –∫–ª—ñ–∫–∞–π, –∫–æ—Ä–æ–±–∫–∞ —Å–∞–º–∞ –ø–æ–∑–µ–ª–µ–Ω—ñ—î...";
    reactBox.style.background = "#3b1111";
    reactBox.textContent = "–∂–¥—å–æ–º —Å–∏–≥–Ω–∞–ª –≤—ñ–¥ –ú—ñ—Ö–∞–ª–∏—á–∞...";
    const delay = 1000 + Math.random() * 3000;
    setTimeout(() => {
      if (reactionState !== "waiting") return;
      reactionState = "ready";
      reactBox.style.background = "#14532d";
      reactBox.textContent = "–ö–õ–Ü–ö–ê–ô –ó–ê–†–ê–ó!!!";
      reactionStartTime = performance.now();
    }, delay);
  }

  reactBox.addEventListener("click", () => {
    if (reactionState === "waiting") {
      reactComment.textContent = "—Ä–∞–Ω–æ –∫–ª–∞—Ü–Ω—É–≤, —Ç–∏ –Ω–µ—Ç–µ—Ä–ø–ª—è—á–∏–π. —Å–ø—Ä–æ–±—É–π –∑–Ω–æ–≤—É.";
      reactionState = "idle";
      reactBox.style.background = "#3b1111";
      reactBox.textContent = "–∂–¥—å–æ–º —Å—Ç–∞—Ä—Ç...";
    } else if (reactionState === "ready") {
      const t = performance.now() - reactionStartTime;
      reactionState = "idle";
      reactBox.style.background = "#3b1111";
      reactBox.textContent = "–∂–¥—å–æ–º —Å—Ç–∞—Ä—Ç...";
      const ms = Math.round(t);
      if (reactionBest === null || ms < reactionBest) {
        reactionBest = ms;
        scoreReactBadge.textContent = "reaction best: " + reactionBest + " ms";
        reactComment.textContent = "–∫—Ä–∞—Å–∞–≤–∞, –Ω–æ–≤–∏–π —Ä–µ–∫–æ—Ä–¥: " + ms + " ms. –º–æ–∑–≥ —â–µ –∂–∏–≤–∏–π.";
      } else {
        reactComment.textContent = "—Ç–≤—ñ–π —á–∞—Å: " + ms + " ms. –º–æ–∂–µ—à –∫—Ä–∞—â–µ.";
      }
    }
  });

  const leaderboardDiv = document.getElementById("leaderboard");

  async function saveScore(type) {
    if (!db) {
      alert("Firebase –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω, —Ç–æ–ø –Ω–µ –∑–±–µ—Ä–µ–∂–µ—Ç—å—Å—è.");
      return;
    }
    if (!currentProfile.name) {
      alert("–≤–∫–∞–∂–∏ –Ω—ñ–∫ –≤ –∞–∫–∫–∞—É–Ω—Ç—ñ –ø–µ—Ä–µ–¥ —Ç–∏–º —è–∫ –ª—ñ–∑—Ç–∏ –≤ —Ç–æ–ø–∏.");
      return;
    }

    if (type === "clicker") {
      const score = clickScore;
      await db.collection("scores").add({
        type: "clicker",
        user: currentProfile.name,
        score,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      alert("—Ä–µ–∑—É–ª—å—Ç–∞—Ç clicker –∑–±–µ—Ä–µ–∂–µ–Ω.");
    } else if (type === "reaction") {
      if (reactionBest === null) {
        alert("—â–µ –Ω–µ –±—É–ª–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–º—ñ—Ä—É —Ä–µ–∞–∫—Ü—ñ—ó.");
        return;
      }
      const score = reactionBest;
      await db.collection("scores").add({
        type: "reaction",
        user: currentProfile.name,
        score,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      alert("—Ä–µ–∑—É–ª—å—Ç–∞—Ç reaction –∑–±–µ—Ä–µ–∂–µ–Ω.");
    }
  }

  function subscribeLeaderboard() {
    if (!db || !leaderboardDiv) return;

    db.collection("scores")
      .where("type", "==", "clicker")
      .orderBy("score", "desc")
      .limit(10)
      .onSnapshot(snap => {
        renderLeaderboard(snap, "CLICKER TOP");
      });

    db.collection("scores")
      .where("type", "==", "reaction")
      .orderBy("score", "asc")
      .limit(10)
      .onSnapshot(snap => {
        renderLeaderboard(snap, "REACTION TOP (ms, –º–µ–Ω—à–µ –∫—Ä–∞—â–µ)");
      });
  }

  function renderLeaderboard(snap, title) {
    if (!leaderboardDiv) return;

    const section = document.createElement("div");
    const h = document.createElement("div");
    h.textContent = title;
    h.style.fontSize = "11px";
    h.style.fontWeight = "700";
    h.style.margin = "4px 0 2px";
    section.appendChild(h);

    snap.forEach(doc => {
      const d = doc.data();
      const row = document.createElement("div");
      row.className = "lb-row";
      const name = document.createElement("span");
      name.textContent = d.user || "–∞–Ω–æ–Ω—ñ–º";
      const score = document.createElement("span");
      score.textContent = d.score;
      row.appendChild(name);
      row.appendChild(score);
      section.appendChild(row);
    });

    leaderboardDiv.innerHTML = "";
    leaderboardDiv.appendChild(section);
  }

  // -----------------------------------------------------------
  // INIT
  // -----------------------------------------------------------
  window.addEventListener("load", () => {
    loadProfile();

    // Canvas init
    if (paintCanvas) {
      ctx = paintCanvas.getContext("2d");
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      paintCanvas.addEventListener("mousedown", e => { e.preventDefault(); startDraw(e); });
      paintCanvas.addEventListener("mousemove", moveDraw);
      paintCanvas.addEventListener("mouseup", stopDraw);
      paintCanvas.addEventListener("mouseleave", stopDraw);

      paintCanvas.addEventListener("touchstart", e => { e.preventDefault(); startDraw(e); }, { passive: false });
      paintCanvas.addEventListener("touchmove", e => { e.preventDefault(); moveDraw(e); }, { passive: false });
      paintCanvas.addEventListener("touchend", e => { e.preventDefault(); stopDraw(e); }, { passive: false });
    }

    // –ü–æ–¥–ø–∏—Å–∫–∏ Firebase
    if (db) {
      subscribePosts();
      subscribeVoices();
      subscribeStrokes();
      subscribeLeaderboard();
    } else {
      console.warn("Firebase –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω ‚Äî –≤—Å–µ –∂–∏–≤–µ —Ç—ñ–ª—å–∫–∏ —É —Ç–µ–±–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ, –±–µ–∑ —à–∞—Ä—ñ–Ω–≥–∞.");
    }

    updateClickScoreBadge();
  });
</script>
</body>
</html>
